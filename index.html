<!DOCTYPE html>
<html>
<head>
  <title>TON Connect</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background-color: #f5f5f5;
    }
    button {
      padding: 12px 24px;
      background: #0088cc;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      margin: 20px 0;
      transition: background 0.3s;
    }
    button:hover {
      background: #006699;
    }
    button:disabled {
      background: #cccccc;
      cursor: not-allowed;
    }
    #status {
      color: #666;
      min-height: 24px;
    }
    #error {
      color: #ff3333;
      min-height: 24px;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîë Connect Tonkeeper</h1>
    <button id="connect-button">Connect Wallet</button>
    <p id="status">Initializing...</p>
    <p id="error"></p>
  </div>

  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', () => {
      const statusEl = document.getElementById('status');
      const errorEl = document.getElementById('error');
      const connectButton = document.getElementById('connect-button');

      // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram WebApp
      if (!window.Telegram?.WebApp) {
        statusEl.textContent = "Please open in Telegram app";
        connectButton.disabled = true;
        return;
      }

      // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
      Telegram.WebApp.ready();
      Telegram.WebApp.expand();

      // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TonConnect
      const connector = new TonConnect.TonConnect({
        manifestUrl: 'https://tonkeeper-bot.vercel.app/tonconnect-manifest.json'
      });

      // 4. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
      connectButton.addEventListener('click', async () => {
        try {
          statusEl.textContent = "Connecting...";
          connectButton.disabled = true;

          const wallets = await connector.getWallets();
          if (wallets.length === 0) {
            throw new Error("No wallets available");
          }

          // –ü–æ–¥–∫–ª—é—á–∞–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ (Tonkeeper)
          await connector.connect(wallets[0]);
        } catch (err) {
          statusEl.textContent = "Connection failed";
          errorEl.textContent = err.message;
          connectButton.disabled = false;
        }
      });

      // 5. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
      connector.onStatusChange((wallet) => {
        if (wallet) {
          statusEl.textContent = "Wallet connected!";
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –≤ Telegram –±–æ—Ç–∞
          Telegram.WebApp.sendData(wallet.account.address);
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–º)
          Telegram.WebApp.close();
        }
      });

      connectButton.disabled = false;
      statusEl.textContent = "Ready to connect!";
    });
  </script>
</body>
</html>